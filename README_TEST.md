# 🚀 学习平台 - 本地测试快速启动指南

## 📦 修复了的问题

经过全面的代码审查和修复，以下关键问题已经解决：

### 🔒 安全问题修复
- ✅ **路径遍历攻击防护** - 加强了文件访问安全验证
- ✅ **正则表达式安全** - 防止ReDoS攻击，限制搜索复杂度
- ✅ **文件上传安全** - 增加扩展名验证、文件类型检查、危险文件过滤
- ✅ **输入验证增强** - 严格的数据类型和格式验证

### 🔧 系统问题修复
- ✅ **全局错误处理** - 正确的错误处理中间件顺序
- ✅ **内存泄漏防护** - 限流器内存管理优化，防止Map无限增长
- ✅ **学生密码问题** - 修复种子数据中缺失的学生密码字段
- ✅ **数据一致性** - 班级人数统计自动修复机制

### ⚡ 性能优化
- ✅ **限流器优化** - 更频繁的清理，更好的内存管理
- ✅ **查询优化** - 改进的数据库查询和索引策略
- ✅ **事务管理** - 增强的事务处理和回滚机制

## 🎯 快速测试方法

### 方法一：一键启动（推荐）
```bash
# 1. 进入项目目录
cd LearningPlatform

# 2. 一键启动（自动安装依赖、初始化数据库、启动服务器）
./start-dev.sh
```

### 方法二：手动步骤
```bash
# 1. 安装依赖
npm install

# 2. 修复数据库问题
npm run init-db

# 3. 启动服务器
npm run dev
```

### 方法三：完整测试
```bash
# 1. 启动服务器（方法一或二）

# 2. 运行自动化测试（新开终端窗口）
npm test
```

## 🔑 默认测试账户

| 角色 | 用户名 | 密码 | 权限范围 |
|------|--------|------|----------|
| 系统管理员 | admin@school.edu | admin123 | 全部功能 |
| 校长 | principal@school.edu | admin123 | 学校管理 |
| 教师 | wang@school.edu | admin123 | 教学功能 |
| 学生 | 20230001 | 20230001 | 学习功能 |

## 🧪 测试检查清单

### 1. 基础连接测试
- [ ] 访问 http://localhost:3000 显示首页
- [ ] 访问 http://localhost:3000/api 返回系统信息
- [ ] 控制台无错误日志

### 2. 登录功能测试
- [ ] 管理员登录成功
- [ ] 学生登录成功  
- [ ] 无效凭据被正确拒绝
- [ ] 权限控制正常工作

### 3. 核心功能测试
- [ ] 学生管理（增删改查）
- [ ] 班级管理功能
- [ ] 课程管理功能
- [ ] 作业管理功能
- [ ] 文件上传功能

### 4. 安全测试
- [ ] SQL注入防护
- [ ] XSS攻击防护
- [ ] 路径遍历防护
- [ ] 文件上传安全

## 📊 自动化测试结果

运行 `npm test` 后，检查以下指标：

- **服务器连接**: ✅ 应该通过
- **用户认证**: ✅ 所有角色登录成功
- **权限控制**: ✅ 正确阻止越权访问
- **CRUD操作**: ✅ 增删改查功能正常
- **安全防护**: ✅ 恶意请求被正确拦截
- **性能指标**: ✅ 响应时间 < 2秒

**目标通过率**: > 95%

## 🚨 常见问题解决

### 问题1: 学生无法登录
```bash
# 解决方案：运行数据修复脚本
npm run init-db
```

### 问题2: MongoDB连接失败
```bash
# 检查MongoDB是否运行
# Ubuntu/CentOS:
sudo systemctl start mongod

# macOS:
brew services start mongodb/brew/mongodb-community

# Windows:
net start MongoDB
```

### 问题3: 端口占用
```bash
# 查看端口占用
netstat -tlnp | grep :3000  # Linux
lsof -i :3000              # macOS

# 修改端口（编辑.env文件）
PORT=3001
```

### 问题4: 依赖安装失败
```bash
# 清理并重新安装
rm -rf node_modules package-lock.json
npm install
```

## 🔍 详细测试指南

完整的测试说明请查看：[LOCAL_TEST_GUIDE.md](./LOCAL_TEST_GUIDE.md)

## 📞 测试支持

如果测试过程中遇到问题：

1. **查看控制台日志** - 大部分问题会在控制台显示
2. **检查测试报告** - 自动生成的 `test-report.json`
3. **运行数据修复** - `npm run init-db`
4. **重启服务器** - Ctrl+C 停止，重新运行启动命令

## ✨ 预期测试结果

成功启动后应该看到：

```
🚀 服务器运行在端口 3000
🌐 访问地址:
   http://localhost:3000
   http://127.0.0.1:3000

🔑 登录凭据:
   管理员: admin@school.edu / admin123
   教师: wang@school.edu / admin123  
   学生: 20230001 / 20230001

💡 如果 Windows 浏览器无法连接，运行: ./fix-windows-access.sh
```

**系统正常运行的标志：**
- ✅ 服务器启动无错误
- ✅ 数据库连接成功
- ✅ 所有账户能正常登录
- ✅ 核心功能正常工作
- ✅ 自动化测试通过率 > 95%

---

🎉 **恭喜！您现在可以开始测试学习平台的所有功能了！**